# README
This is sample code when learning antlr4.

* [CSV](#csv)
* [JSON2XML](#json2xml)
* [Cymbol2Graphviz](#cymbol2graphviz)
* [CymbolChecker](#cymbolchecker)



## CSV 
Purpose: Load csv file content to a list, which element is a mapping from csv header to value

Structure:
- CSV.g4        -> csv grammar definition file
- t.csv         -> sample csv file to test
- LoadCSV.java  -> main logic file
- other files   -> generated by antlr

Run:

```
$ cat t.csv
-> 
Details,Month,Amount
Mid Bonus,June,"$2,000"
,January,"""zippo"""
Total Bonuses,"","$5,000"


$ antlr4 CSV.g4
-> generate the CSV*.java files

$ javac CSV*.java LoadCSV.java
-> compile to *.class file

$ java LoadCSV t.csv
-> Output [{Details=Mid Bonus, Month=June, Amount="$2,000"}, {Details=, Month=January, Amount="""zippo"""}, {Details=Total Bonuses, Month="", Amount="$5,000"}]

```


## JSON2XML 
Purpose: transfer json file to xml file

Structure:
- JSON.g4        -> json grammar definition file
- t.json         -> sample json file to test
- JSON2XML.java  -> main logic file
- other files   -> generated by antlr

Run:

```
$ cat t.json
-> {
       "description" : "An imaginary server config file",
       "logs" : {"level":"verbose", "dir":"/var/log"},
       "host" : "antlr.org",
       "admin": ["parrt", "tombu"],
       "aliases": []
   }


$ antlr4 JSON.g4
-> generate the JSON*.java files

$ javac *.java
-> compile to *.class file

$ java JSON2XML t.json
-> Output as below
<description>An imaginary server config file</description>
<logs>
<level>verbose</level>
<dir>/var/log</dir>
</logs>
<host>antlr.org</host>
<admin>
<element>parrt</element>
<element>tombu</element>
</admin>
<aliases></aliases>
```

## Cymbol2Graphviz 
Purpose: generate a graphviz of caller -> callee relations in cymbol programming language.

Structure:
- Cymbol.g4        -> Cymbol grammar definition file
- t.cymbol         -> sample cymbol file to test
- CallGraph.java  -> main logic file
- other files   -> generated by antlr

Run:

```
$ cat t.json
-> 
int main() { fact(); a(); }

float fact(int n) {
  print(n);
  
  if ( n==0 ) then return 1;
  return n * fact(n-1);
}

void a() { int x = b(); if false then {c(); d();} }
void b() { c(); }
void c() { b(); }
void d() { }
void e() { }



$ antlr4 Cymbol.g4
-> generate the Cymbol*.java files

$ javac *.java
-> compile to *.class file

$ java CallGraph t.cymbol
-> 
edges: {main=[fact, a], fact=[print, fact], a=[b, c, d], b=[c], c=[b]}, functions: [main, fact, a, b, c, d, e]
digraph G {
  ranksep=.25;
  edge [arrowsize=.5]
  node [shape=circle, fontname="ArialNarrow",
        fontsize=12, fixedsize=true, height=.45];
  main; fact; a; b; c; d; e; 
  main -> fact;
  main -> a;
  fact -> print;
  fact -> fact;
  a -> b;
  a -> c;
  a -> d;
  b -> c;
  c -> b;
}

```

## CymbolChecker
Purpose: check cymbol language gramma error, such as variable used before definition, variable symbol used as function symbol, function symbol used as variable symbol

Structure:
- Cymbol.g4        -> Cymbol grammar definition file
- vars.cymbol, vars2.cymbol         -> sample cymbol file to test
- DefPhase.java  -> First phase, to find all scope, all function symbols, all variable symbols
- RefPhase.java  -> Second phase, to check symbols used correctly
- Symbol table code  -> from <<Language Implementation Patterns[Par09]>>
    - BaseScope.java
    - CheckSymbols.java
    - FunctionSymbol.java
    - GlobalScope.java
    - LocalScope.java
    - Scope.java
    - Symbol.java
    - VariableSymbol.java
- other files   -> generated by antlr

Run:

```
$ cat t.json
-> vars.symbol
int f(int x, float y) {
    g();   // forward reference is ok
    i = 3; // no declaration for i (error)
    g = 4; // g is not variable (error)
    return x + y; // x, y are defined, so no problem
}

void g() {
    int x = 0;
    float y;
    y = 9; // y is defined
    f();   // backward reference is ok
    z();   // no such function (error)
    y();   // y is not function (error)
    x = f; // f is not a variable (error)
}


void a() { int x = b(); if false then {c(); d();} }
void b() { c(); }
void c() { b(); }
void d() { }
void e() { }



$ antlr4 Cymbol.g4
-> generate the Cymbol*.java files

$ javac *.java
-> compile to *.class file

$ java CheckSymbols vars.cymbol
-> 
locals:[]
function<f:tINT>:[<x:tINT>, <y:tFLOAT>]
locals:[x, y]
function<g:tVOID>:[]
globals:[f, g]
line 3:4 no such variable: i
line 4:4 g is not a variable
line 13:4 no such function: z
line 14:4 y is not a function
line 15:8 f is not a variable


```

